<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫∫ÊùêÁ¥π‰ªã„Ç∑„Çπ„ÉÜ„É† - „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script src="config.js"></script>
    <script src="gas-connector.js"></script>
    <script src="gas-form-submit.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        /* HarmosÈ¢®„Ç´„É©„Éº„Éë„É¨„ÉÉ„Éà */
        :root {
            --primary-blue: #2563eb;      
            --secondary-blue: #1d4ed8;    
            --light-blue: #3b82f6;        
            --accent-blue: #0ea5e9;       
            --bg-blue: #eff6ff;           
            --text-dark: #1e293b;         
            --text-gray: #64748b;         
            --border-gray: #e2e8f0;       
            --bg-white: #ffffff;
            --bg-gray: #f8fafc;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', Roboto, sans-serif;
            background: var(--bg-gray);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
        }
        
        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border-gray);
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 95vw;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .tab-navigation {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border-gray);
            overflow-x: auto;
        }
        
        .tab-list {
            max-width: 95vw;
            margin: 0 auto;
            display: flex;
            gap: 0;
            list-style: none;
            padding: 0;
            margin-bottom: 0;
        }
        
        .tab-item {
            position: relative;
        }
        
        .tab-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px 24px;
            background: transparent;
            border: none;
            color: var(--text-gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }
        
        .tab-button:hover {
            color: var(--text-dark);
            background: var(--bg-gray);
        }
        
        .tab-button.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }
        
        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .main-content {
            max-width: 95vw;
            margin: 0 auto;
            padding: 24px;
        }
        
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        /* „Éñ„É¨„ÉÉ„Éâ„ÇØ„É©„É† */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: var(--text-gray);
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .breadcrumb-separator {
            color: var(--border-gray);
        }
        
        /* „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÂ∞ÇÁî®„Çπ„Çø„Ç§„É´ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .dashboard-card {
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .dashboard-card:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
            transform: translateY(-2px);
        }
        
        .dashboard-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .dashboard-card-icon {
            font-size: 24px;
            width: 48px;
            height: 48px;
            background: var(--bg-blue);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dashboard-card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }
        
        .dashboard-card-description {
            color: var(--text-gray);
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
        }
        
        /* Áµ±Ë®à„Ç´„Éº„Éâ */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-gray);
            margin: 0;
        }
        
        /* ÂÖ±ÈÄö„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà */
        .section {
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0 0 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary-blue);
            color: white;
            border: 1px solid var(--primary-blue);
        }
        
        .btn-primary:hover {
            background: var(--secondary-blue);
            border-color: var(--secondary-blue);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }
        
        .btn-outline:hover {
            background: var(--primary-blue);
            color: white;
        }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-list {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                üè¢ ‰∫∫ÊùêÁ¥π‰ªã„Ç∑„Çπ„ÉÜ„É†
            </div>
            <div class="user-menu">
                <span style="color: var(--text-gray); font-size: 14px;">ÁÆ°ÁêÜËÄÖ</span>
                <div style="width: 32px; height: 32px; background: var(--primary-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">U</div>
            </div>
        </div>
    </header>

    <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <nav class="tab-navigation">
        <ul class="tab-list">
            <li class="tab-item">
                <button class="tab-button active" data-tab="dashboard">
                    üè† „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="job-seeker-form">
                    üë§ Ê±ÇËÅ∑ËÄÖÁÆ°ÁêÜ
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="job-listings">
                    üìä Ê±Ç‰∫∫ÁÆ°ÁêÜ
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="matching">
                    üéØ „Éû„ÉÉ„ÉÅ„É≥„Ç∞
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="analytics">
                    üìà ÂàÜÊûê„Éª„É¨„Éù„Éº„Éà
                </button>
            </li>
            
        </ul>
    </nav>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="main-content">
        <!-- „Éñ„É¨„ÉÉ„Éâ„ÇØ„É©„É† -->
        <div class="breadcrumb" id="breadcrumb">
            <div class="breadcrumb-item">
                <span>üè†</span>
                <span>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
            </div>
        </div>

        <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section id="dashboard-section" class="page-section active">
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
            </h1>

            <!-- Áµ±Ë®àÊ¶ÇË¶Å -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-number" id="totalJobSeekers">0</div>
                    <p class="stat-label">ÁôªÈå≤Ê±ÇËÅ∑ËÄÖÊï∞</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalJobs">0</div>
                    <p class="stat-label">ÁÆ°ÁêÜÊ±Ç‰∫∫Êï∞</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeMatches">0</div>
                    <p class="stat-label">ÈÄ≤Ë°å‰∏≠Ê°à‰ª∂</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="successfulPlacements">0</div>
                    <p class="stat-label">ÊàêÁ¥ÑÊï∞</p>
                </div>
            </div>

            <!-- Ê©üËÉΩ„Ç´„Éº„Éâ -->
            <div class="dashboard-grid">
                <div class="dashboard-card" onclick="switchTab('job-seeker-form')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">üë§</div>
                        <h3 class="dashboard-card-title">Ê±ÇËÅ∑ËÄÖÁôªÈå≤</h3>
                    </div>
                    <p class="dashboard-card-description">
                        Ëª¢ËÅ∑Â∏åÊúõËÄÖ„ÅÆË©≥Á¥∞ÊÉÖÂ†±„ÇíÁôªÈå≤„Åó„ÄÅÂ∏åÊúõÊù°‰ª∂„ÇÑÂÑ™ÂÖàÂ∫¶„ÇíÁÆ°ÁêÜ„Åß„Åç„Åæ„Åô„ÄÇÂ±•Ê≠¥Êõ∏„ÉªËÅ∑ÂãôÁµåÊ≠¥Êõ∏„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´„ÇÇÂØæÂøú„ÄÇ
                    </p>
                </div>

                <div class="dashboard-card" onclick="switchTab('job-listings')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">üìä</div>
                        <h3 class="dashboard-card-title">AIÊ±Ç‰∫∫ÁÆ°ÁêÜ</h3>
                    </div>
                    <p class="dashboard-card-description">
                        PDF„Éï„Ç°„Ç§„É´„Åã„ÇâAI„ÅåËá™Âãï„ÅßÊ±Ç‰∫∫ÊÉÖÂ†±„ÇíÊäΩÂá∫„ÄÇÊãÖÂΩìËÄÖ„ÇÑ„Çπ„ÉÜ„Éº„Çø„ÇπÁÆ°ÁêÜ„ÅßÂäπÁéáÁöÑ„Å™Ê±Ç‰∫∫„Éá„Éº„Çø„Éô„Éº„Çπ„ÇíÊßãÁØâ„ÄÇ
                    </p>
                </div>

                <div class="dashboard-card" onclick="switchTab('matching')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">üéØ</div>
                        <h3 class="dashboard-card-title">„Çπ„Éû„Éº„Éà„Éû„ÉÉ„ÉÅ„É≥„Ç∞</h3>
                    </div>
                    <p class="dashboard-card-description">
                        Ê±ÇËÅ∑ËÄÖ„ÅÆÊù°‰ª∂„Å®Ê±Ç‰∫∫ÊÉÖÂ†±„ÇíAI„ÅåÂàÜÊûê„Åó„ÄÅÊúÄÈÅ©„Å™„Éû„ÉÉ„ÉÅ„É≥„Ç∞„ÇíËá™Âãï„ÅßÊèêÊ°à„Åó„Åæ„Åô„ÄÇ
                    </p>
                </div>

                <div class="dashboard-card" onclick="switchTab('analytics')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">üìà</div>
                        <h3 class="dashboard-card-title">ÂàÜÊûê„Éª„É¨„Éù„Éº„Éà</h3>
                    </div>
                    <p class="dashboard-card-description">
                        ÊàêÁ¥ÑÁéá„ÄÅÂøúÂãüÁä∂Ê≥Å„ÄÅÊ±Ç‰∫∫ÂÇæÂêë„Å™„Å©„ÇíÂàÜÊûê„Åó„ÄÅ„Éì„Ç∏„Éç„ÇπÊîπÂñÑ„Å´ÂΩπÁ´ã„Å§„Ç§„É≥„Çµ„Ç§„Éà„ÇíÊèê‰æõ„Åó„Åæ„Åô„ÄÇ
                    </p>
                </div>
            </div>

            <!-- ÊúÄËøë„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£ -->
            <div class="section">
                <h3 class="section-title">üìã ÊúÄËøë„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£</h3>
                <div id="recent-activities">
                    <p style="color: var(--text-gray); text-align: center; padding: 40px;">
                        „Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ<br>
                        Ê±ÇËÅ∑ËÄÖ„ÅÆÁôªÈå≤„ÇÑÊ±Ç‰∫∫„ÅÆËøΩÂä†„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                    </p>
                </div>
            </div>
            
        </section>

        <!-- Ê±ÇËÅ∑ËÄÖÁôªÈå≤„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section id="job-seeker-form-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    ‚Üê „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                Ê±ÇËÅ∑ËÄÖÁÆ°ÁêÜ
            </h1>
            
            <div class="section">
                <p style="margin-bottom: 12px; color: var(--text-gray);">
                    Ê±ÇËÅ∑ËÄÖ„ÅÆ‰∏ÄË¶ßÁÆ°ÁêÜ„Å®ÁôªÈå≤„Åå„Åß„Åç„Åæ„Åô„ÄÇ
                </p>
                <div class="section-actions">
                    <a href="job-seeker-form.html" class="btn btn-primary" target="_blank">üìù Ê±ÇËÅ∑ËÄÖÁôªÈå≤„Ç∑„Çπ„ÉÜ„É†„ÇíÈñã„Åè</a>
                </div>
            </div>

            <!-- ÁôªÈå≤Ê∏à„ÅøÊ±ÇËÅ∑ËÄÖ‰∏ÄË¶ßÔºàÁÆ°ÁêÜÂÜÖÔºâ -->
            <div class="section">
                <div style="display:flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
                    <h3 class="section-title" style="margin:0;">üë§ ÁôªÈå≤Ê∏à„ÅøÊ±ÇËÅ∑ËÄÖ‰∏ÄË¶ß</h3>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input id="seekerSearchDash" type="text" placeholder="üîé Ê∞èÂêç/„É°„Éº„É´/„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢" class="btn" style="padding:8px 10px; border:1px solid var(--border-gray); background:#fff;">
                        <button class="btn btn-outline" onclick="loadJobSeekersDash()">üîÑ ÂÜçË™≠„ÅøËæº„Åø</button>
                    </div>
                </div>
                <div id="seekerMetaDash" style="margin-top:8px; color: var(--text-gray); font-size:13px;">Ë™≠„ÅøËæº„ÅøÂæÖ„Å°...</div>
                <div style="overflow-x:auto; margin-top:10px;">
                    <table class="table" style="min-width: 900px;">
                        <thead>
                            <tr>
                                <th>Ê∞èÂêç</th>
                                <th>„É°„Éº„É´</th>
                                <th>Â∏åÊúõÂã§ÂãôÂú∞</th>
                                <th>Â∏åÊúõÂπ¥Âèé</th>
                                <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                <th>ÁôªÈå≤Êó•</th>
                            </tr>
                        </thead>
                        <tbody id="seekerTableBodyDash">
                            <tr><td colspan="6" style="padding:12px; color: var(--text-gray);">Ë™≠„ÅøËæº„Åø‰∏≠...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Ê±Ç‰∫∫ÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section id="job-listings-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    ‚Üê „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                AIÊ±Ç‰∫∫ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
            </h1>
            
            <div class="section">
                <p style="margin-bottom: 12px; color: var(--text-gray);">
                    Ê±Ç‰∫∫„ÅÆ‰∏ÄË¶ßÁÆ°ÁêÜ„Å®AIËß£ÊûêÔºàHarmosÔºâ„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åô„ÄÇ
                </p>
                <div class="section-actions">
                    <a href="job-listing-manager-harmos.html" class="btn btn-outline" target="_blank">üìä Ê±Ç‰∫∫ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†„ÇíÈñã„Åè</a>
                </div>
            </div>

            <!-- „Éö„Éº„Ç∏ÂÜÖ„Éó„É¨„Éì„É•„ÉºÂüã„ÇÅËæº„Åø -->
            <!-- „Éö„Éº„Ç∏ÂÜÖ„Éó„É¨„Éì„É•„ÉºÂâäÈô§ -->

            <!-- ÁôªÈå≤Ê∏à„ÅøÊ±Ç‰∫∫‰∏ÄË¶ßÔºàÁÆ°ÁêÜÂÜÖÔºâ -->
            <div class="section">
                <div style="display:flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
                    <h3 class="section-title" style="margin:0;">üìã ÁôªÈå≤Ê∏à„ÅøÊ±Ç‰∫∫‰∏ÄË¶ß</h3>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input id="jobSearchDash" type="text" placeholder="üîé Ê±Ç‰∫∫Âêç/‰ºöÁ§æÂêç/„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢" class="btn" style="padding:8px 10px; border:1px solid var(--border-gray); background:#fff;">
                        <button class="btn btn-outline" onclick="loadJobListingsDash()">üîÑ ÂÜçË™≠„ÅøËæº„Åø</button>
                    </div>
                </div>
                <div id="jobMetaDash" style="margin-top:8px; color: var(--text-gray); font-size:13px;">Ë™≠„ÅøËæº„ÅøÂæÖ„Å°...</div>
                <div class="table-container" style="margin-top:10px;">
                    <table class="table" style="min-width: 1000px;">
                        <thead>
                            <tr>
                                <th>Ê±Ç‰∫∫Âêç</th>
                                <th>‰ºöÁ§æÂêç</th>
                                <th>Âã§ÂãôÂú∞</th>
                                <th>Âπ¥Âèé</th>
                                <th>„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                                <th>ÁôªÈå≤Êó•</th>
                            </tr>
                        </thead>
                        <tbody id="jobTableBodyDash">
                            <tr><td colspan="6" style="padding:12px; color: var(--text-gray);">Ë™≠„ÅøËæº„Åø‰∏≠...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- „Éû„ÉÉ„ÉÅ„É≥„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section id="matching-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    ‚Üê „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">„Çπ„Éû„Éº„Éà„Éû„ÉÉ„ÉÅ„É≥„Ç∞</h1>

            <!-- „Éû„ÉÉ„ÉÅ„É≥„Ç∞Êìç‰Ωú„Éë„Éç„É´ -->
            <div class="section">
                <h3 class="section-title">üéØ Ê±ÇËÅ∑ËÄÖ„ÅÆÊù°‰ª∂„Å´Âêà„ÅÜÊ±Ç‰∫∫„ÇíÊ§úÁ¥¢</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; align-items: end;">
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">Ê±ÇËÅ∑ËÄÖ„ÇíÈÅ∏Êäû</label>
                        <select id="seekerSelect" class="btn" style="width: 100%; border: 1px solid var(--border-gray); background: white;">
                            <option value="">Ë™≠„ÅøËæº„Åø‰∏≠...</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">‰∏ä‰Ωç‰ª∂Êï∞</label>
                        <select id="topN" class="btn" style="width: 100%; border: 1px solid var(--border-gray); background: white;">
                            <option>5</option>
                            <option selected>10</option>
                            <option>20</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">ÊúÄ‰Ωé‰∏ÄËá¥Êï∞</label>
                        <select id="minScore" class="btn" style="width: 100%; border: 1px solid var(--border-gray); background: white;">
                            <option value="0">ÊåáÂÆö„Å™„Åó</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">Âã§ÂãôÂú∞„Ç≠„Éº„ÉØ„Éº„Éâ</label>
                        <input id="locKeyword" class="btn" placeholder="‰æã: Êù±‰∫¨/Â§ßÈò™/„É™„É¢„Éº„Éà" style="width: 100%; border: 1px solid var(--border-gray); background: white;" />
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">„Ç™„Éó„Ç∑„Éß„É≥</label>
                        <div style="display:flex; gap: 12px; align-items:center;">
                            <label style="display:flex; gap:6px; align-items:center; font-size: 14px; color: var(--text-gray);">
                                <input type="checkbox" id="remoteOnly" /> „É™„É¢„Éº„Éà„ÅÆ„Åø
                            </label>
                        </div>
                    </div>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="runMatching()">üîé „Éû„ÉÉ„ÉÅ„É≥„Ç∞„ÇíÂÆüË°å</button>
                        <button class="btn btn-outline" onclick="initMatching()">üîÑ „Éá„Éº„ÇøÂÜçË™≠„ÅøËæº„Åø</button>
                        <button class="btn btn-primary" onclick="saveSelectedApplications()">üì• ÂøúÂãüÁÆ°ÁêÜ„Å´ÁôªÈå≤</button>
                    </div>
                </div>
                <div id="matchingWarning" style="display:none; margin-top:12px; background:#fff4e5; border:1px solid #ffd8a8; color:#b26a00; padding:10px; border-radius:6px;">
                    Google Sheets API„Ç≠„Éº„ÅåÊú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅ„ÄÅ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„ÄÇAPIË®≠ÂÆö„ÇíË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                </div>
            </div>

            <!-- „Éû„ÉÉ„ÉÅÁµêÊûú -->
            <div class="section">
                <h3 class="section-title">üìã „Éû„ÉÉ„ÉÅÁµêÊûú</h3>
                <div class="table-container">
                    <table class="table" id="matchingTable" style="min-width: 1100px;">
                        <thead>
                            <tr>
                                <th style="width:60px;">ÈÅ∏Êäû</th>
                                <th style="width:110px;">‰∏ÄËá¥Êï∞</th>
                                <th style="width:220px;">Ê±Ç‰∫∫Âêç</th>
                                <th style="width:160px;">‰ºöÁ§æÂêç</th>
                                <th style="width:140px;">Âπ¥Âèé</th>
                                <th style="width:160px;">Âã§ÂãôÂú∞</th>
                                <th>‰∏ÄËá¥„Éù„Ç§„É≥„Éà</th>
                            </tr>
                        </thead>
                        <tbody id="matchingBody">
                            <tr><td colspan="6" style="color: var(--text-gray);">Ê±ÇËÅ∑ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Äå„Éû„ÉÉ„ÉÅ„É≥„Ç∞„ÇíÂÆüË°å„Äç„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ÂàÜÊûê„Éª„É¨„Éù„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section id="analytics-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    ‚Üê „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                ÂàÜÊûê„Éª„É¨„Éù„Éº„Éà
            </h1>
            
            <div class="section">
                <h3 class="section-title">üìà „Éì„Ç∏„Éç„ÇπÂàÜÊûêÔºàÈñãÁô∫‰∫àÂÆöÔºâ</h3>
                <p style="color: var(--text-gray); margin-bottom: 24px;">
                    „Éá„Éº„Çø„Éâ„É™„Éñ„É≥„Å™ÊÑèÊÄùÊ±∫ÂÆö„Çí„Çµ„Éù„Éº„Éà„Åô„ÇãÂàÜÊûêÊ©üËÉΩ„Åß„Åô„ÄÇ
                </p>
                
                <div style="background: var(--bg-blue); padding: 20px; border-radius: 8px; margin: 16px 0;">
                    <h4 style="margin: 0 0 12px 0; color: var(--primary-blue);">üìä ‰∫àÂÆöÊ©üËÉΩ</h4>
                    <ul style="margin: 0; color: var(--text-gray);">
                        <li>ÊàêÁ¥ÑÁéá„ÉªÂøúÂãüÁéá„ÅÆÂèØË¶ñÂåñ</li>
                        <li>Ê±Ç‰∫∫Â∏ÇÂ†¥„Éà„É¨„É≥„ÉâÂàÜÊûê</li>
                        <li>ÊãÖÂΩìËÄÖÂà•„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</li>
                        <li>ÂèéÁõä„ÉªÂ£≤‰∏ä„É¨„Éù„Éº„Éà</li>
                    </ul>
                </div>
                
                <button class="btn btn-primary" onclick="alert('ËøëÊó•ÂÖ¨Èñã‰∫àÂÆö„Åß„ÅôÔºÅ')">
                    üîß ÈñãÁô∫‰∏≠...
                </button>
            </div>
        </section>

        <!-- Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <section id="settings-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    ‚Üê „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å´Êàª„Çã
                </button>
            </div>

            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">APIË®≠ÂÆö</h1>

            <div class="section">
                <p style="margin-bottom: 12px; color: var(--text-gray);">
                    Google Sheets API„Ç≠„Éº„ÄÅOpenAI API„Ç≠„Éº„ÄÅGAS URLÔºà‰ªªÊÑèÔºâ„ÅÆË®≠ÂÆö„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ
                </p>
                <div class="section-actions">
                    <button class="btn btn-outline" onclick="toggleEmbed('apiSettingsEmbed','api-setup.html')">Ë°®Á§∫/ÈùûË°®Á§∫</button>
                    <a href="api-setup.html" class="btn btn-primary" target="_blank">Êñ∞„Åó„ÅÑ„Çø„Éñ„ÅßÈñã„Åè</a>
                </div>
                <div id="apiSettingsEmbed" style="display: none; margin-top: 12px;">
                    <iframe id="apiSettingsIframe" src="" style="width: 100%; height: 900px; border: 1px solid var(--border-gray); border-radius: 8px;"></iframe>
                </div>
            </div>
        </section>
    </main>

    <script>
        // GASÈÄ£Êê∫Ôºà„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÁî®Ôºâ
        let gasConnector;
        let formSubmitter;

        // „Çø„ÉñÂàá„ÇäÊõø„ÅàÊ©üËÉΩ
        function switchTab(tabName) {
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Éú„Çø„É≥„Åã„Çâ active „ÇØ„É©„Çπ„ÇíÂâäÈô§
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // „Åô„Åπ„Å¶„ÅÆ„Éö„Éº„Ç∏„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Éú„Çø„É≥„Å´ active „ÇØ„É©„Çπ„ÇíËøΩÂä†
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„Éö„Éº„Ç∏„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
            document.getElementById(`${tabName}-section`).classList.add('active');
            
            // „Éñ„É¨„ÉÉ„Éâ„ÇØ„É©„É†„ÇíÊõ¥Êñ∞
            updateBreadcrumb(tabName);
            // Ë®≠ÂÆöÂæå„Å´ÂèçÊò†„Åß„Åç„Çã„Çà„ÅÜ„ÄÅ„Éû„ÉÉ„ÉÅ„É≥„Ç∞„Çø„ÉñË°®Á§∫ÊôÇ„Å´ÂÜçÂàùÊúüÂåñ
            if (tabName === 'matching') {
                initMatching();
            } else if (tabName === 'job-seeker-form') {
                loadJobSeekersDash();
            } else if (tabName === 'job-listings') {
                if (typeof loadJobListingsDash === 'function') loadJobListingsDash();
            } else if (tabName === 'dashboard') {
                updateStats();
            }
        }

        // Âüã„ÇÅËæº„ÅøË°®Á§∫ÂàáÊõøÔºàÂàùÂõû„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´srcË®≠ÂÆöÔºâ
        function toggleEmbed(containerId, src) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const iframe = container.querySelector('iframe');
            const isHidden = container.style.display === 'none' || container.style.display === '';
            if (isHidden) {
                container.style.display = 'block';
                if (iframe && !iframe.src) {
                    iframe.src = src;
                }
            } else {
                container.style.display = 'none';
            }
        }

        // „Éñ„É¨„ÉÉ„Éâ„ÇØ„É©„É†Êõ¥Êñ∞
        function updateBreadcrumb(tabName) {
            const breadcrumb = document.getElementById('breadcrumb');
            const tabNames = {
                'dashboard': '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ',
                'job-seeker-form': 'Ê±ÇËÅ∑ËÄÖÁôªÈå≤',
                'job-listings': 'Ê±Ç‰∫∫ÁÆ°ÁêÜ',
                'matching': '„Éû„ÉÉ„ÉÅ„É≥„Ç∞',
                'analytics': 'ÂàÜÊûê„Éª„É¨„Éù„Éº„Éà'
            };
            
            if (tabName === 'dashboard') {
                breadcrumb.innerHTML = `
                    <div class="breadcrumb-item">
                        <span>üè†</span>
                        <span>„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
                    </div>
                `;
            } else {
                breadcrumb.innerHTML = `
                    <div class="breadcrumb-item">
                        <span>üè†</span>
                        <span style="cursor: pointer;" onclick="switchTab('dashboard')">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
                    </div>
                    <span class="breadcrumb-separator">></span>
                    <div class="breadcrumb-item">
                        <span>${tabNames[tabName]}</span>
                    </div>
                `;
            }
        }

        // „Çø„Éñ„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        // Áµ±Ë®à„Éá„Éº„Çø„ÅÆÊõ¥Êñ∞ÔºàGAS„ÅÆ„ÅøÔºâ
        async function updateStats() {
            try {
                let stats = null;
                if (typeof gasConnector !== 'undefined' && gasConnector) {
                    try { stats = await gasConnector.getStatistics(); } catch (e) { console.warn('GASÁµ±Ë®àÂèñÂæóÂ§±Êïó', e); }
                }
                if (!stats) stats = { totalJobSeekers: 0, totalJobListings: 0, totalApplications: 0, successfulPlacements: 0 };

                document.getElementById('totalJobSeekers').textContent = stats.totalJobSeekers || '0';
                document.getElementById('totalJobs').textContent = stats.totalJobListings || '0';
                document.getElementById('activeMatches').textContent = stats.totalApplications || '0';
                document.getElementById('successfulPlacements').textContent = stats.successfulPlacements || '0';
                console.log('Áµ±Ë®à„Éá„Éº„Çø„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü:', stats);
            } catch (error) {
                console.error('Áµ±Ë®à„Éá„Éº„ÇøÊõ¥Êñ∞„Ç®„É©„Éº:', error);
                document.getElementById('totalJobSeekers').textContent = '0';
                document.getElementById('totalJobs').textContent = '0';
                document.getElementById('activeMatches').textContent = '0';
                document.getElementById('successfulPlacements').textContent = '0';
            }
        }
        
        // 5ÂàÜ„Åä„Åç„Å´Áµ±Ë®à„ÇíËá™ÂãïÊõ¥Êñ∞
        function startAutoUpdate() {
            // ÂàùÂõûÂÆüË°å
            updateStats();
            
            // 5ÂàÜ(300000ms)„Åä„Åç„Å´Êõ¥Êñ∞
            setInterval(updateStats, 300000);
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // GASÂàùÊúüÂåñÔºàÂÖà„Å´Ë°å„ÅÜ„Åì„Å®„ÅßÂàùÂõû„ÅÆÁµ±Ë®à„Å´„ÇÇÂèçÊò†„Åï„Çå„ÇãÔºâ
            const GAS_URL = (typeof GASUtils !== 'undefined') ? GASUtils.getGASUrl() : (typeof CONFIG !== 'undefined' ? CONFIG.GAS_URL : '');
            if (GAS_URL) {
                gasConnector = new GASConnector(GAS_URL);
                formSubmitter = new GASFormSubmitter(GAS_URL);
                console.log('GASÈÄ£Êê∫„ÇíÂàùÊúüÂåñ:', GAS_URL);
            } else {
                console.warn('GAS URL „ÅåÊú™Ë®≠ÂÆö„Åß„Åô„ÄÇAPIË®≠ÂÆö„Åß‰∏äÊõ∏„ÅçÂèØËÉΩ„Åß„Åô„ÄÇ');
            }
            // 5ÂàÜ„Åä„ÅçËá™ÂãïÊõ¥Êñ∞„ÇíÈñãÂßãÔºàÂàùÂõûÂÆüË°å„ÅßGASÂÄ§„ÇíË°®Á§∫Ôºâ
            startAutoUpdate();
            
            // ÊúÄËøë„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„ÇíÂãïÁöÑ„Å´ÁîüÊàêÔºà„Çµ„É≥„Éó„É´Ôºâ
            setTimeout(() => {
                const activities = document.getElementById('recent-activities');
                activities.innerHTML = `
                    <div style="border-left: 3px solid var(--primary-blue); padding-left: 16px; margin-bottom: 16px;">
                        <div style="font-weight: 500; color: var(--text-dark);">Êñ∞„Åó„ÅÑÊ±ÇËÅ∑ËÄÖ„ÅåÁôªÈå≤„Åï„Çå„Åæ„Åó„Åü</div>
                        <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">2ÊôÇÈñìÂâç</div>
                    </div>
                    <div style="border-left: 3px solid var(--success); padding-left: 16px; margin-bottom: 16px;">
                        <div style="font-weight: 500; color: var(--text-dark);">Ê±Ç‰∫∫„ÄåWeb„Éá„Ç∂„Ç§„Éä„Éº„Äç„ÅÆÂøúÂãü„Åå„ÅÇ„Çä„Åæ„Åó„Åü</div>
                        <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">5ÊôÇÈñìÂâç</div>
                    </div>
                    <div style="border-left: 3px solid var(--warning); padding-left: 16px;">
                        <div style="font-weight: 500; color: var(--text-dark);">AI„Åß3‰ª∂„ÅÆÊ±Ç‰∫∫„ÇíËá™ÂãïÁôªÈå≤„Åó„Åæ„Åó„Åü</div>
                        <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">1Êó•Ââç</div>
                    </div>
                `;
            }, 1000);
            // „Éû„ÉÉ„ÉÅ„É≥„Ç∞ÂàùÊúü„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
            initMatching();
        });

        // ===== Ê±ÇËÅ∑ËÄÖ‰∏ÄË¶ßÔºà„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÔºâ =====
        let SEEKERS_CACHE_DASH = [];
        function pickDash(obj, keys) {
            for (const k of keys) {
                if (obj && obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== '') return obj[k];
            }
            return '';
        }
        function parseDateDash(val) {
            if (!val) return null;
            try {
                if (Object.prototype.toString.call(val) === '[object Date]') return val;
                const d = new Date(val);
                return isNaN(d.getTime()) ? null : d;
            } catch (_) { return null; }
        }
        async function loadJobSeekersDash() {
            const meta = document.getElementById('seekerMetaDash');
            const tbody = document.getElementById('seekerTableBodyDash');
            if (!meta || !tbody) return;
            try {
                meta.textContent = 'GAS„Åã„ÇâË™≠„ÅøËæº„Åø‰∏≠...';
                if (!window.gasConnector) {
                    const GAS_URL = (typeof GASUtils !== 'undefined') ? GASUtils.getGASUrl() : (typeof CONFIG !== 'undefined' ? CONFIG.GAS_URL : '');
                    if (GAS_URL) window.gasConnector = new GASConnector(GAS_URL);
                }
                let list = [];
                if (window.gasConnector) {
                    try { list = await window.gasConnector.getJobSeekers(); } catch (e) { console.warn('GASÂèñÂæóÂ§±Êïó', e); }
                }
                if (!Array.isArray(list)) list = [];
                list.sort((a, b) => {
                    const da = parseDateDash(pickDash(a, ['ÁôªÈå≤Êó•ÊôÇ','ÁôªÈå≤Êó•','‰ΩúÊàêÊó•','created','timestamp']));
                    const db = parseDateDash(pickDash(b, ['ÁôªÈå≤Êó•ÊôÇ','ÁôªÈå≤Êó•','‰ΩúÊàêÊó•','created','timestamp']));
                    return (db?.getTime()||0) - (da?.getTime()||0);
                });
                SEEKERS_CACHE_DASH = list;
                renderSeekerTableDash();
            } catch (err) {
                console.error('Ê±ÇËÅ∑ËÄÖ‰∏ÄË¶ß„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', err);
                meta.textContent = 'Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (err.message || err);
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color:#c00;">Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</td></tr>';
            }
        }
        function renderSeekerTableDash() {
            const meta = document.getElementById('seekerMetaDash');
            const tbody = document.getElementById('seekerTableBodyDash');
            if (!meta || !tbody) return;
            const q = (document.getElementById('seekerSearchDash').value || '').trim().toLowerCase();
            let rows = SEEKERS_CACHE_DASH;
            if (q) rows = rows.filter(o => JSON.stringify(o).toLowerCase().includes(q));
            meta.textContent = `Ë°®Á§∫‰ª∂Êï∞: ${rows.length} / Á∑è‰ª∂Êï∞: ${SEEKERS_CACHE_DASH.length}`;
            if (rows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color: var(--text-gray);">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td></tr>';
                return;
            }
            const html = rows.slice(0, 50).map(o => {
                const name = pickDash(o, ['Ê∞èÂêç','name']);
                const email = pickDash(o, ['„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ','email']);
                const loc = pickDash(o, ['Â∏åÊúõÂã§ÂãôÂú∞','desiredLocation']);
                const sal = pickDash(o, ['Â∏åÊúõÂπ¥Âèé','desiredSalary']);
                const status = pickDash(o, ['„Çπ„ÉÜ„Éº„Çø„Çπ','status']);
                const d = pickDash(o, ['ÁôªÈå≤Êó•ÊôÇ','ÁôªÈå≤Êó•','‰ΩúÊàêÊó•','created','timestamp']);
                return `
                    <tr>
                        <td>${name || '-'}</td>
                        <td>${email || '-'}</td>
                        <td>${loc || '-'}</td>
                        <td>${sal || '-'}</td>
                        <td>${status || '-'}</td>
                        <td>${d ? new Date(d).toLocaleString() : '-'}</td>
                    </tr>`;
            }).join('');
            tbody.innerHTML = html;
        }
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('seekerSearchDash');
            if (input) input.addEventListener('input', renderSeekerTableDash);
        });

        // ===== Ê±Ç‰∫∫‰∏ÄË¶ßÔºà„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÔºöÊ±Ç‰∫∫ÁÆ°ÁêÜÂÜÖÔºâ =====
        let JOBS_CACHE_DASH = [];
        function salaryTextDash(job) {
            const s = (job['Âπ¥Âèé'] || '').toString().trim();
            if (s) return s;
            const min = job['salaryMin'] || '';
            const max = job['salaryMax'] || '';
            return (min || max) ? `${min || ''}${(min||max?'-':'')}${max || ''}` : '';
        }
        async function loadJobListingsDash() {
            const meta = document.getElementById('jobMetaDash');
            const tbody = document.getElementById('jobTableBodyDash');
            if (!meta || !tbody) return;
            try {
                meta.textContent = 'GAS„Åã„ÇâË™≠„ÅøËæº„Åø‰∏≠...';
                if (!window.gasConnector) {
                    const GAS_URL = (typeof GASUtils !== 'undefined') ? GASUtils.getGASUrl() : (typeof CONFIG !== 'undefined' ? CONFIG.GAS_URL : '');
                    if (GAS_URL) window.gasConnector = new GASConnector(GAS_URL);
                }
                let list = [];
                if (window.gasConnector) {
                    try { list = await window.gasConnector.getJobListings(); } catch (e) { console.warn('GASÂèñÂæóÂ§±Êïó', e); }
                }
                if (!Array.isArray(list)) list = [];
                list.sort((a,b) => {
                    const da = parseDateDash(pickDash(a, ['ÁôªÈå≤Êó•ÊôÇ','ÁôªÈå≤Êó•','‰ΩúÊàêÊó•','created','timestamp']));
                    const db = parseDateDash(pickDash(b, ['ÁôªÈå≤Êó•ÊôÇ','ÁôªÈå≤Êó•','‰ΩúÊàêÊó•','created','timestamp']));
                    return (db?.getTime()||0) - (da?.getTime()||0);
                });
                JOBS_CACHE_DASH = list;
                renderJobListingsDash();
            } catch (err) {
                console.error('Ê±Ç‰∫∫‰∏ÄË¶ß„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', err);
                meta.textContent = 'Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (err.message || err);
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color:#c00;">Ë™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</td></tr>';
            }
        }
        function renderJobListingsDash() {
            const meta = document.getElementById('jobMetaDash');
            const tbody = document.getElementById('jobTableBodyDash');
            if (!meta || !tbody) return;
            const q = (document.getElementById('jobSearchDash').value || '').trim().toLowerCase();
            let rows = JOBS_CACHE_DASH;
            if (q) rows = rows.filter(o => JSON.stringify(o).toLowerCase().includes(q));
            meta.textContent = `Ë°®Á§∫‰ª∂Êï∞: ${rows.length} / Á∑è‰ª∂Êï∞: ${JOBS_CACHE_DASH.length}`;
            if (rows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color: var(--text-gray);">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td></tr>';
                return;
            }
            const html = rows.slice(0, 50).map(o => {
                const title = pickDash(o, ['Ê±Ç‰∫∫Âêç','title']);
                const company = pickDash(o, ['‰ºöÁ§æÂêç','company']);
                const loc = pickDash(o, ['Âã§ÂãôÂú∞','location']);
                const sal = salaryTextDash(o);
                const status = pickDash(o, ['„Çπ„ÉÜ„Éº„Çø„Çπ','status']);
                const d = pickDash(o, ['ÁôªÈå≤Êó•ÊôÇ','ÁôªÈå≤Êó•','‰ΩúÊàêÊó•','created','timestamp']);
                return `
                    <tr>
                        <td>${title || '-'}</td>
                        <td>${company || '-'}</td>
                        <td>${loc || '-'}</td>
                        <td>${sal || '-'}</td>
                        <td>${status || '-'}</td>
                        <td>${d ? new Date(d).toLocaleString() : '-'}</td>
                    </tr>`;
            }).join('');
            tbody.innerHTML = html;
        }
        document.addEventListener('DOMContentLoaded', () => {
            const input2 = document.getElementById('jobSearchDash');
            if (input2) input2.addEventListener('input', renderJobListingsDash);
        });

        // ===== „Çπ„Éû„Éº„Éà„Éû„ÉÉ„ÉÅ„É≥„Ç∞ÔºàË™≠„ÅøËæº„Åø„ÅØGoogle Sheets API„Çí‰ΩøÁî®Ôºâ =====

        let seekersData = [];
        let jobsData = [];

        let lastMatched = [];

        async function initMatching() {
            try {
                // „Åæ„ÅöGAS„Åã„Çâ„ÅÆÂèñÂæó„ÇíË©¶„Åô
                let seekers = [], jobs = [];
                let usedGAS = false;
                if (gasConnector) {
                    try {
                        GASUtils && GASUtils.showProgress && GASUtils.showProgress('GAS„Åã„Çâ„Éá„Éº„ÇøÂèñÂæó‰∏≠...');
                        [seekers, jobs] = await Promise.all([
                            gasConnector.getJobSeekers(),
                            gasConnector.getJobListings()
                        ]);
                        // ÊúüÂæÖ„Åô„ÇãÈÖçÂàóÂΩ¢Âºè„ÅãÊ§úË®º
                        if (Array.isArray(seekers) && Array.isArray(jobs)) {
                            usedGAS = true;
                        } else {
                            console.warn('GASÂøúÁ≠î„ÅåÈÖçÂàó„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇSheets API„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Åó„Åæ„Åô„ÄÇ');
                            usedGAS = false;
                        }
                    } catch (e) {
                        console.warn('GAS„Åã„Çâ„ÅÆÂèñÂæó„Å´Â§±Êïó„ÄÅSheets API„Å´„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ:', e);
                    }
                }

                if (!usedGAS) {
                    // Êú¨Áï™ÈÅãÁî®„Åß„ÅØGASÁµåÁî±„ÅÆ„Åø„Çí‰ΩøÁî®Ôºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁÑ°ÂäπÔºâ
                    document.getElementById('matchingWarning').style.display = 'block';
                    const sel = document.getElementById('seekerSelect');
                    if (sel) sel.innerHTML = '<option value="">GASÊú™Êé•Á∂ö</option>';
                    GASUtils && GASUtils.hideProgress && GASUtils.hideProgress();
                    return;
                }

                seekersData = seekers;
                jobsData = jobs;

                populateSeekerSelect(seekersData);
                GASUtils && GASUtils.showProgress && GASUtils.showProgress('„Éá„Éº„ÇøÂèñÂæó„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ');
                setTimeout(() => GASUtils && GASUtils.hideProgress && GASUtils.hideProgress(), 800);
            } catch (error) {
                console.error('„Éû„ÉÉ„ÉÅ„É≥„Ç∞ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                document.getElementById('matchingWarning').style.display = 'block';
                GASUtils && GASUtils.showProgress && GASUtils.showProgress('„Ç®„É©„Éº: „Éá„Éº„ÇøÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                setTimeout(() => GASUtils && GASUtils.hideProgress && GASUtils.hideProgress(), 2000);
            }
        }

        // GASÂõ∫ÂÆöÈÅãÁî®„ÅÆ„Åü„ÇÅ„ÄÅlocalStorageË®≠ÂÆö„ÅÆÁõ£Ë¶ñ„ÅØ‰∏çË¶Å

        function toObjects(headers, rows) {
            return rows.map(r => {
                const o = {}; headers.forEach((h, i) => o[h] = r[i]); return o;
            });
        }

        function populateSeekerSelect(list) {
            const sel = document.getElementById('seekerSelect');
            sel.innerHTML = '<option value="">Ê±ÇËÅ∑ËÄÖ„ÇíÈÅ∏Êäû</option>';
            list.forEach((s, idx) => {
                const name = s['Ê∞èÂêç'] || s['name'] || `Ê±ÇËÅ∑ËÄÖ${idx+1}`;
                const email = s['„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ'] || s['email'] || '';
                const opt = document.createElement('option');
                opt.value = String(idx);
                opt.textContent = `${name}${email ? ' / ' + email : ''}`;
                sel.appendChild(opt);
            });
        }

        function runMatching() {
            const idx = document.getElementById('seekerSelect').value;
            const topN = parseInt(document.getElementById('topN').value, 10) || 10;
            const minScore = parseInt(document.getElementById('minScore').value, 10) || 0;
            const remoteOnly = document.getElementById('remoteOnly').checked;
            const locKw = (document.getElementById('locKeyword').value || '').trim();
            if (idx === '' || !seekersData.length || !jobsData.length) return;
            const seeker = seekersData[Number(idx)];
            let scored = jobsData
                .map(job => {
                    const score = computeScore(seeker, job);
                    const reasons = matchReasons(seeker, job);
                    const remoteHit = reasons.includes('„É™„É¢„Éº„Éà');
                    const jLoc = (job['Âã§ÂãôÂú∞'] || job['location'] || '').toString();
                    const locHit = locKw ? jLoc.includes(locKw) : true;
                    return { job, score, reasons, remoteHit, locHit };
                })
                .filter(x => x.score >= minScore && x.locHit && (!remoteOnly || x.remoteHit))
                .sort((a,b) => b.score - a.score)
                .slice(0, topN);
            renderMatches(scored);
        }

        function parseSalary(s) {
            if (!s) return {min:null, max:null};
            const m = String(s).replace(/[,ÂÜÜ‰∏áÂÜÜ]/g,'');
            const parts = m.split('-').map(x => parseInt(x,10)).filter(n => !isNaN(n));
            if (parts.length === 1) return {min:parts[0], max:parts[0]};
            if (parts.length >= 2) return {min:parts[0], max:parts[1]};
            return {min:null, max:null};
        }

        function norm(str) { return String(str||'').toLowerCase().replace(/\s+/g,''); }
        function includesAny(text, keywords) {
            const t = norm(text);
            return keywords.some(k => t.includes(norm(k)));
        }

        // ÂçòÁ¥îÂä†ÁÇπÁâàÔºàÂêÑÊù°‰ª∂1ÁÇπÔºâ
        function computeScore(seeker, job) {
            const { matches } = evaluateMatches(seeker, job);
            // 1Êù°‰ª∂=1ÁÇπ„ÅßÂêàË®à
            return Object.values(matches).reduce((acc, v) => acc + (v ? 1 : 0), 0);
        }

        function evaluateMatches(seeker, job) {
            const sLoc = (seeker['Â∏åÊúõÂã§ÂãôÂú∞'] || seeker['desiredLocation'] || '').trim();
            const sLocDetail = (seeker['Ë©≥Á¥∞Â∏åÊúõÂú∞Âüü'] || seeker['specificCity'] || '').trim();
            const jLoc = (job['Âã§ÂãôÂú∞'] || job['location'] || '').trim();

            const sSal = parseSalary(seeker['Â∏åÊúõÂπ¥Âèé'] || seeker['desiredSalary']);
            const jSal = parseSalary(job['Âπ¥Âèé'] || (job['salaryMin'] && job['salaryMax'] ? `${job['salaryMin']}-${job['salaryMax']}` : ''));

            const sWeekend = String(seeker['ÂúüÊó•‰ºë„ÅøÂ∏åÊúõ'] || '').includes('„ÅÇ„Çä');
            const jWeekend = String(job['ÂúüÊó•‰ºë„Åø'] || '').includes('„ÅÇ„Çä');

            const sH = parseInt(String(seeker['Âπ¥Èñì‰ºëÊó•Â∏åÊúõ']||'').replace(/[^0-9]/g,''),10);
            const jH = parseInt(String(job['Âπ¥Èñì‰ºëÊó•']||'').replace(/[^0-9]/g,''),10);

            const sReqList = (seeker['ÂøúÂãüÊù°‰ª∂'] || seeker['requirements'] || '').split(/[„ÄÅ,\s]+/).filter(Boolean);
            const jReqText = (job['ÂøúÂãüÊù°‰ª∂'] || job['requirements'] || '').toString();

            // ËøΩÂä†„ÅÆ„Çà„Åè„ÅÇ„ÇãÊù°‰ª∂
            const sEmp = (seeker['ÈõáÁî®ÂΩ¢ÊÖã'] || seeker['employmentType'] || '').trim();
            const jEmp = (job['ÈõáÁî®ÂΩ¢ÊÖã'] || job['employmentType'] || '').trim();
            const seekerWantsRemote = includesAny(sLoc + ' ' + sLocDetail + ' ' + sReqList.join(' '), ['„É™„É¢„Éº„Éà','Âú®ÂÆÖ','„Éï„É´„É™„É¢„Éº„Éà']);
            const jobIsRemote = includesAny(jLoc + ' ' + (job['ÂÇôËÄÉ']||job['notes']||''), ['„É™„É¢„Éº„Éà','Âú®ÂÆÖ','„Éï„É´„É™„É¢„Éº„Éà']);
            const sRole = (seeker['Â∏åÊúõËÅ∑Á®Æ'] || seeker['jobTypes'] || '').toString();
            const jRoleText = (job['ËÅ∑Á®Æ'] || job['Ê±Ç‰∫∫Âêç'] || job['title'] || '').toString();

            const matches = {
                location: !!(sLoc && jLoc && jLoc.includes(sLoc)) || (!!sLocDetail && jLoc.includes(sLocDetail)),
                salary: !!(sSal.min && jSal.max && jSal.max >= sSal.min),
                weekendOff: sWeekend && jWeekend,
                annualHolidays: (!isNaN(sH) && !isNaN(jH) && jH >= sH),
                requirements: sReqList.length > 0 && sReqList.some(k => jReqText.includes(k)),
                employmentType: !!(sEmp && jEmp && (jEmp.includes(sEmp) || sEmp.includes(jEmp))),
                remote: seekerWantsRemote ? jobIsRemote : false,
                role: !!(sRole && jRoleText && includesAny(jRoleText, Array.isArray(sRole)? sRole : String(sRole).split(/[„ÄÅ,\s]+/)))
            };

            return { matches };
        }

        function matchReasons(seeker, job) {
            const { matches } = evaluateMatches(seeker, job);
            const reasons = [];
            if (matches.location) reasons.push('Âã§ÂãôÂú∞');
            if (matches.salary) reasons.push('Âπ¥Âèé');
            if (matches.weekendOff) reasons.push('ÂúüÊó•‰ºë„Åø');
            if (matches.annualHolidays) reasons.push('Âπ¥Èñì‰ºëÊó•');
            if (matches.requirements) reasons.push('ÂøúÂãüÊù°‰ª∂');
            if (matches.employmentType) reasons.push('ÈõáÁî®ÂΩ¢ÊÖã');
            if (matches.remote) reasons.push('„É™„É¢„Éº„Éà');
            if (matches.role) reasons.push('ËÅ∑Á®Æ');
            return reasons;
        }

        function renderMatches(items) {
            const tbody = document.getElementById('matchingBody');
            tbody.innerHTML = '';
            if (!items.length) {
                tbody.innerHTML = '<tr><td colspan="6" style="color: var(--text-gray);">‰∏ÄËá¥„Åô„ÇãÊ±Ç‰∫∫„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</td></tr>';
                return;
            }
            const total = 8; // Êù°‰ª∂Êï∞
            lastMatched = items;
            items.forEach(({job, score, reasons}, idx) => {
                const tr = document.createElement('tr');
                const salary = job['Âπ¥Âèé'] || (job['salaryMin'] && job['salaryMax'] ? `${job['salaryMin']}-${job['salaryMax']}` : '');
                const chips = reasons.map(r => `<span style="display:inline-block; padding:2px 6px; margin:2px; border:1px solid #e2e8f0; border-radius:12px; font-size:11px; background:#f8fafc;">${r}</span>`).join('');
                tr.innerHTML = `
                    <td><input type="checkbox" class="match-select" data-index="${idx}" /></td>
                    <td><strong>${score}</strong> / ${total}</td>
                    <td>${job['Ê±Ç‰∫∫Âêç'] || job['title'] || ''}</td>
                    <td>${job['‰ºöÁ§æÂêç'] || job['company'] || ''}</td>
                    <td>${salary}</td>
                    <td>${job['Âã§ÂãôÂú∞'] || job['location'] || ''}</td>
                    <td>${chips}</td>
                `;
                // Ë©≥Á¥∞Ë°åÔºà„ÇØ„É™„ÉÉ„ÇØ„ÅßÂ±ïÈñãÔºâ
                const details = document.createElement('tr');
                details.style.display = 'none';
                const detailsTd = document.createElement('td');
                detailsTd.colSpan = 6;
                detailsTd.style.background = '#f8fafc';
                detailsTd.style.borderLeft = '3px solid #2563eb';
                const jobReq = job['ÂøúÂãüÊù°‰ª∂'] || job['requirements'] || '';
                const jobNotes = job['ÂÇôËÄÉ'] || job['notes'] || '';
                detailsTd.innerHTML = `
                    <div style="padding:12px;">
                        <div style="font-size:13px; color:#64748b; margin-bottom:6px;">Ë©≥Á¥∞</div>
                        ${jobReq ? `<div><strong>ÂøúÂãüÊù°‰ª∂:</strong> ${jobReq}</div>` : ''}
                        ${jobNotes ? `<div style="margin-top:6px;"><strong>ÂÇôËÄÉ:</strong> ${jobNotes}</div>` : ''}
                    </div>
                `;
                details.appendChild(detailsTd);

                tr.style.cursor = 'pointer';
                tr.addEventListener('click', () => {
                    details.style.display = details.style.display === 'none' ? '' : 'none';
                });

                tbody.appendChild(tr);
                tbody.appendChild(details);
            });
        }

        async function saveSelectedApplications() {
            try {
                const idx = document.getElementById('seekerSelect').value;
                if (idx === '' || !seekersData.length) {
                    alert('Ê±ÇËÅ∑ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
                const seeker = seekersData[Number(idx)];
                const seekerName = seeker['Ê∞èÂêç'] || seeker['name'] || '';
                const checks = Array.from(document.querySelectorAll('.match-select:checked'));
                if (checks.length === 0) {
                    alert('ÁôªÈå≤„Åô„ÇãÊ±Ç‰∫∫„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                if (!gasConnector || !formSubmitter) {
                    alert('GASÈÄ£Êê∫„ÅåÊú™Ë®≠ÂÆö„Åß„Åô„ÄÇAPIË®≠ÂÆö„ÅßGAS URL„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }

                GASUtils && GASUtils.showProgress && GASUtils.showProgress('ÂøúÂãüÁÆ°ÁêÜ„Å´ÁôªÈå≤‰∏≠...');
                let ok = 0, ng = 0;
                for (const c of checks) {
                    const i = Number(c.getAttribute('data-index'));
                    const item = lastMatched[i];
                    if (!item) { ng++; continue; }
                    const job = item.job;
                    const payload = {
                        jobSeekerName: seekerName,
                        jobTitle: job['Ê±Ç‰∫∫Âêç'] || job['title'] || '',
                        company: job['‰ºöÁ§æÂêç'] || job['company'] || '',
                        status: 'ÂÄôË£ú'
                    };
                    try {
                        try {
                            await gasConnector.upsertApplication(payload);
                        } catch (e) {
                            await formSubmitter.submitData('upsertApplication', payload);
                        }
                        ok++;
                    } catch (e) {
                        console.warn('ÁôªÈå≤Â§±Êïó:', e);
                        ng++;
                    }
                }
                alert(`ÂøúÂãüÁÆ°ÁêÜ„Å´ÁôªÈå≤„Åó„Åæ„Åó„Åü: ÊàêÂäü ${ok}‰ª∂ / Â§±Êïó ${ng}‰ª∂`);
                GASUtils && GASUtils.showProgress && GASUtils.showProgress('ÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
            } catch (e) {
                console.error('ÂøúÂãüÁÆ°ÁêÜÁôªÈå≤„Ç®„É©„Éº:', e);
                alert('ÁôªÈå≤„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + (e.message || e));
            }
        }
    </script>
</body>
</html>
