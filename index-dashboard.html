<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººæç´¹ä»‹ã‚·ã‚¹ãƒ†ãƒ  - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script src="config.js"></script>
    <script src="gas-connector.js"></script>
    <script src="gas-form-submit.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        /* Harmosé¢¨ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
        :root {
            --primary-blue: #2563eb;      
            --secondary-blue: #1d4ed8;    
            --light-blue: #3b82f6;        
            --accent-blue: #0ea5e9;       
            --bg-blue: #eff6ff;           
            --text-dark: #1e293b;         
            --text-gray: #64748b;         
            --border-gray: #e2e8f0;       
            --bg-white: #ffffff;
            --bg-gray: #f8fafc;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', Roboto, sans-serif;
            background: var(--bg-gray);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border-gray);
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 95vw;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .tab-navigation {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border-gray);
            overflow-x: auto;
        }
        
        .tab-list {
            max-width: 95vw;
            margin: 0 auto;
            display: flex;
            gap: 0;
            list-style: none;
            padding: 0;
            margin-bottom: 0;
        }
        
        .tab-item {
            position: relative;
        }
        
        .tab-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px 24px;
            background: transparent;
            border: none;
            color: var(--text-gray);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }
        
        .tab-button:hover {
            color: var(--text-dark);
            background: var(--bg-gray);
        }
        
        .tab-button.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .main-content {
            max-width: 95vw;
            margin: 0 auto;
            padding: 24px;
        }
        
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        /* ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ  */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: var(--text-gray);
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .breadcrumb-separator {
            color: var(--border-gray);
        }
        
        /* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .dashboard-card {
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .dashboard-card:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
            transform: translateY(-2px);
        }
        
        .dashboard-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .dashboard-card-icon {
            font-size: 24px;
            width: 48px;
            height: 48px;
            background: var(--bg-blue);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .dashboard-card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }
        
        .dashboard-card-description {
            color: var(--text-gray);
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
        }
        
        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-gray);
            margin: 0;
        }
        
        /* å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */
        .section {
            background: var(--bg-white);
            border: 1px solid var(--border-gray);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0 0 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary-blue);
            color: white;
            border: 1px solid var(--primary-blue);
        }
        
        .btn-primary:hover {
            background: var(--secondary-blue);
            border-color: var(--secondary-blue);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }
        
        .btn-outline:hover {
            background: var(--primary-blue);
            color: white;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .tab-list {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                ğŸ¢ äººæç´¹ä»‹ã‚·ã‚¹ãƒ†ãƒ 
            </div>
            <div class="user-menu">
                <span style="color: var(--text-gray); font-size: 14px;">ç®¡ç†è€…</span>
                <div style="width: 32px; height: 32px; background: var(--primary-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">U</div>
            </div>
        </div>
    </header>

    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="tab-navigation">
        <ul class="tab-list">
            <li class="tab-item">
                <button class="tab-button active" data-tab="dashboard">
                    ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="job-seeker-form">
                    ğŸ‘¤ æ±‚è·è€…ç®¡ç†
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="job-listings">
                    ğŸ“Š æ±‚äººç®¡ç†
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="matching">
                    ğŸ¯ ãƒãƒƒãƒãƒ³ã‚°
                </button>
            </li>
            <li class="tab-item">
                <button class="tab-button" data-tab="analytics">
                    ğŸ“ˆ åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ
                </button>
            </li>
            
        </ul>
    </nav>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <!-- ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ  -->
        <div class="breadcrumb" id="breadcrumb">
            <div class="breadcrumb-item">
                <span>ğŸ </span>
                <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
            </div>
        </div>

        <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="dashboard-section" class="page-section active">
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
            </h1>

            <!-- çµ±è¨ˆæ¦‚è¦ -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-number" id="totalJobSeekers">0</div>
                    <p class="stat-label">ç™»éŒ²æ±‚è·è€…æ•°</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalJobs">0</div>
                    <p class="stat-label">ç®¡ç†æ±‚äººæ•°</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeMatches">0</div>
                    <p class="stat-label">é€²è¡Œä¸­æ¡ˆä»¶</p>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="successfulPlacements">0</div>
                    <p class="stat-label">æˆç´„æ•°</p>
                </div>
            </div>

            <!-- æ©Ÿèƒ½ã‚«ãƒ¼ãƒ‰ -->
            <div class="dashboard-grid">
                <div class="dashboard-card" onclick="switchTab('job-seeker-form')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">ğŸ‘¤</div>
                        <h3 class="dashboard-card-title">æ±‚è·è€…ç™»éŒ²</h3>
                    </div>
                    <p class="dashboard-card-description">
                        è»¢è·å¸Œæœ›è€…ã®è©³ç´°æƒ…å ±ã‚’ç™»éŒ²ã—ã€å¸Œæœ›æ¡ä»¶ã‚„å„ªå…ˆåº¦ã‚’ç®¡ç†ã§ãã¾ã™ã€‚å±¥æ­´æ›¸ãƒ»è·å‹™çµŒæ­´æ›¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«ã‚‚å¯¾å¿œã€‚
                    </p>
                </div>

                <div class="dashboard-card" onclick="switchTab('job-listings')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">ğŸ“Š</div>
                        <h3 class="dashboard-card-title">AIæ±‚äººç®¡ç†</h3>
                    </div>
                    <p class="dashboard-card-description">
                        PDFãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰AIãŒè‡ªå‹•ã§æ±‚äººæƒ…å ±ã‚’æŠ½å‡ºã€‚æ‹…å½“è€…ã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ã§åŠ¹ç‡çš„ãªæ±‚äººãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã€‚
                    </p>
                </div>

                <div class="dashboard-card" onclick="switchTab('matching')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">ğŸ¯</div>
                        <h3 class="dashboard-card-title">ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°</h3>
                    </div>
                    <p class="dashboard-card-description">
                        æ±‚è·è€…ã®æ¡ä»¶ã¨æ±‚äººæƒ…å ±ã‚’AIãŒåˆ†æã—ã€æœ€é©ãªãƒãƒƒãƒãƒ³ã‚°ã‚’è‡ªå‹•ã§ææ¡ˆã—ã¾ã™ã€‚
                    </p>
                </div>

                <div class="dashboard-card" onclick="switchTab('analytics')">
                    <div class="dashboard-card-header">
                        <div class="dashboard-card-icon">ğŸ“ˆ</div>
                        <h3 class="dashboard-card-title">åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ</h3>
                    </div>
                    <p class="dashboard-card-description">
                        æˆç´„ç‡ã€å¿œå‹ŸçŠ¶æ³ã€æ±‚äººå‚¾å‘ãªã©ã‚’åˆ†æã—ã€ãƒ“ã‚¸ãƒã‚¹æ”¹å–„ã«å½¹ç«‹ã¤ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚
                    </p>
                </div>
            </div>

            <!-- æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ -->
            <div class="section">
                <h3 class="section-title">ğŸ“‹ æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</h3>
                <div id="recent-activities">
                    <p style="color: var(--text-gray); text-align: center; padding: 40px;">
                        ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
                        æ±‚è·è€…ã®ç™»éŒ²ã‚„æ±‚äººã®è¿½åŠ ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚
                    </p>
                </div>
            </div>
            
        </section>

        <!-- æ±‚è·è€…ç™»éŒ²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="job-seeker-form-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                æ±‚è·è€…ç®¡ç†
            </h1>
            
            <div class="section">
                <p style="margin-bottom: 12px; color: var(--text-gray);">
                    æ±‚è·è€…ã®ä¸€è¦§ç®¡ç†ã¨ç™»éŒ²ãŒã§ãã¾ã™ã€‚
                </p>
                <div class="section-actions">
                    <a href="job-seeker-form.html" class="btn btn-primary" target="_blank">ğŸ“ æ±‚è·è€…ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ã</a>
                </div>
            </div>

            <!-- ç™»éŒ²æ¸ˆã¿æ±‚è·è€…ä¸€è¦§ï¼ˆç®¡ç†å†…ï¼‰ -->
            <div class="section">
                <div style="display:flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
                    <h3 class="section-title" style="margin:0;">ğŸ‘¤ ç™»éŒ²æ¸ˆã¿æ±‚è·è€…ä¸€è¦§</h3>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input id="seekerSearchDash" type="text" placeholder="ğŸ” æ°å/ãƒ¡ãƒ¼ãƒ«/ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢" class="btn" style="padding:8px 10px; border:1px solid var(--border-gray); background:#fff;">
                        <button class="btn btn-outline" onclick="loadJobSeekersDash()">ğŸ”„ å†èª­ã¿è¾¼ã¿</button>
                    </div>
                </div>
                <div id="seekerMetaDash" style="margin-top:8px; color: var(--text-gray); font-size:13px;">èª­ã¿è¾¼ã¿å¾…ã¡...</div>
                <div style="overflow-x:auto; margin-top:10px;">
                    <table class="table" style="min-width: 900px;">
                        <thead>
                            <tr>
                                <th>æ°å</th>
                                <th>ãƒ¡ãƒ¼ãƒ«</th>
                                <th>å¸Œæœ›å‹¤å‹™åœ°</th>
                                <th>å¸Œæœ›å¹´å</th>
                                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th>ç™»éŒ²æ—¥</th>
                            </tr>
                        </thead>
                        <tbody id="seekerTableBodyDash">
                            <tr><td colspan="6" style="padding:12px; color: var(--text-gray);">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- æ±‚äººç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="job-listings-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                AIæ±‚äººç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
            </h1>
            
            <div class="section">
                <p style="margin-bottom: 12px; color: var(--text-gray);">
                    æ±‚äººã®ä¸€è¦§ç®¡ç†ã¨AIè§£æï¼ˆHarmosï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
                </p>
                <div class="section-actions">
                    <a href="job-listing-manager-harmos.html" class="btn btn-outline" target="_blank">ğŸ“Š æ±‚äººç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’é–‹ã</a>
                </div>
            </div>

            <!-- ãƒšãƒ¼ã‚¸å†…ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼åŸ‹ã‚è¾¼ã¿ -->
            <!-- ãƒšãƒ¼ã‚¸å†…ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰Šé™¤ -->

            <!-- ç™»éŒ²æ¸ˆã¿æ±‚äººä¸€è¦§ï¼ˆç®¡ç†å†…ï¼‰ -->
            <div class="section">
                <div style="display:flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap;">
                    <h3 class="section-title" style="margin:0;">ğŸ“‹ ç™»éŒ²æ¸ˆã¿æ±‚äººä¸€è¦§</h3>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input id="jobSearchDash" type="text" placeholder="ğŸ” æ±‚äººå/ä¼šç¤¾å/ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢" class="btn" style="padding:8px 10px; border:1px solid var(--border-gray); background:#fff;">
                        <button class="btn btn-outline" onclick="loadJobListingsDash()">ğŸ”„ å†èª­ã¿è¾¼ã¿</button>
                    </div>
                </div>
                <div id="jobMetaDash" style="margin-top:8px; color: var(--text-gray); font-size:13px;">èª­ã¿è¾¼ã¿å¾…ã¡...</div>
                <div class="table-container" style="margin-top:10px;">
                    <table class="table" style="min-width: 1000px;">
                        <thead>
                            <tr>
                                <th>æ±‚äººå</th>
                                <th>ä¼šç¤¾å</th>
                                <th>å‹¤å‹™åœ°</th>
                                <th>å¹´å</th>
                                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                <th>ç™»éŒ²æ—¥</th>
                            </tr>
                        </thead>
                        <tbody id="jobTableBodyDash">
                            <tr><td colspan="6" style="padding:12px; color: var(--text-gray);">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ãƒãƒƒãƒãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="matching-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°</h1>

            <!-- ãƒãƒƒãƒãƒ³ã‚°æ“ä½œãƒ‘ãƒãƒ« -->
            <div class="section">
                <h3 class="section-title">ğŸ¯ æ±‚è·è€…ã®æ¡ä»¶ã«åˆã†æ±‚äººã‚’æ¤œç´¢</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; align-items: end;">
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">æ±‚è·è€…ã‚’é¸æŠ</label>
                        <select id="seekerSelect" class="btn" style="width: 100%; border: 1px solid var(--border-gray); background: white;">
                            <option value="">èª­ã¿è¾¼ã¿ä¸­...</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">ä¸Šä½ä»¶æ•°</label>
                        <select id="topN" class="btn" style="width: 100%; border: 1px solid var(--border-gray); background: white;">
                            <option>5</option>
                            <option selected>10</option>
                            <option>20</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">æœ€ä½ä¸€è‡´æ•°</label>
                        <select id="minScore" class="btn" style="width: 100%; border: 1px solid var(--border-gray); background: white;">
                            <option value="0">æŒ‡å®šãªã—</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">å‹¤å‹™åœ°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</label>
                        <input id="locKeyword" class="btn" placeholder="ä¾‹: æ±äº¬/å¤§é˜ª/ãƒªãƒ¢ãƒ¼ãƒˆ" style="width: 100%; border: 1px solid var(--border-gray); background: white;" />
                    </div>
                    <div>
                        <label style="font-size: 13px; color: var(--text-gray);">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
                        <div style="display:flex; gap: 12px; align-items:center;">
                            <label style="display:flex; gap:6px; align-items:center; font-size: 14px; color: var(--text-gray);">
                                <input type="checkbox" id="remoteOnly" /> ãƒªãƒ¢ãƒ¼ãƒˆã®ã¿
                            </label>
                        </div>
                    </div>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="runMatching()">ğŸ” ãƒãƒƒãƒãƒ³ã‚°ã‚’å®Ÿè¡Œ</button>
                        <button class="btn btn-outline" onclick="initMatching()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿</button>
                        <button class="btn btn-primary" onclick="saveSelectedApplications()">ğŸ“¥ å¿œå‹Ÿç®¡ç†ã«ç™»éŒ²</button>
                    </div>
                </div>
                <div id="matchingWarning" style="display:none; margin-top:12px; background:#fff4e5; border:1px solid #ffd8a8; color:#b26a00; padding:10px; border-radius:6px;">
                    Google Sheets APIã‚­ãƒ¼ãŒæœªè¨­å®šã®ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚APIè¨­å®šã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
                </div>
            </div>

            <!-- ãƒãƒƒãƒçµæœ -->
            <div class="section">
                <h3 class="section-title">ğŸ“‹ ãƒãƒƒãƒçµæœ</h3>
                <div class="table-container">
                    <table class="table" id="matchingTable" style="min-width: 1100px;">
                        <thead>
                            <tr>
                                <th style="width:60px;">é¸æŠ</th>
                                <th style="width:110px;">ä¸€è‡´æ•°</th>
                                <th style="width:220px;">æ±‚äººå</th>
                                <th style="width:160px;">ä¼šç¤¾å</th>
                                <th style="width:140px;">å¹´å</th>
                                <th style="width:160px;">å‹¤å‹™åœ°</th>
                                <th>ä¸€è‡´ãƒã‚¤ãƒ³ãƒˆ</th>
                            </tr>
                        </thead>
                        <tbody id="matchingBody">
                            <tr><td colspan="6" style="color: var(--text-gray);">æ±‚è·è€…ã‚’é¸æŠã—ã¦ã€Œãƒãƒƒãƒãƒ³ã‚°ã‚’å®Ÿè¡Œã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="analytics-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
                </button>
            </div>
            
            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">
                åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ
            </h1>
            
            <div class="section">
                <h3 class="section-title">ğŸ“ˆ ãƒ“ã‚¸ãƒã‚¹åˆ†æï¼ˆé–‹ç™ºäºˆå®šï¼‰</h3>
                <p style="color: var(--text-gray); margin-bottom: 24px;">
                    ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªæ„æ€æ±ºå®šã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹åˆ†ææ©Ÿèƒ½ã§ã™ã€‚
                </p>
                
                <div style="background: var(--bg-blue); padding: 20px; border-radius: 8px; margin: 16px 0;">
                    <h4 style="margin: 0 0 12px 0; color: var(--primary-blue);">ğŸ“Š äºˆå®šæ©Ÿèƒ½</h4>
                    <ul style="margin: 0; color: var(--text-gray);">
                        <li>æˆç´„ç‡ãƒ»å¿œå‹Ÿç‡ã®å¯è¦–åŒ–</li>
                        <li>æ±‚äººå¸‚å ´ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</li>
                        <li>æ‹…å½“è€…åˆ¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</li>
                        <li>åç›Šãƒ»å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</li>
                    </ul>
                </div>
                
                <button class="btn btn-primary" onclick="alert('è¿‘æ—¥å…¬é–‹äºˆå®šã§ã™ï¼')">
                    ğŸ”§ é–‹ç™ºä¸­...
                </button>
            </div>
        </section>

        <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="settings-section" class="page-section">
            <div style="margin-bottom: 24px;">
                <button class="btn btn-outline" onclick="switchTab('dashboard')">
                    â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
                </button>
            </div>

            <h1 style="font-size: 32px; font-weight: 700; margin: 0 0 32px 0; color: var(--text-dark);">APIè¨­å®š</h1>

            <div class="section">
                <p style="margin-bottom: 12px; color: var(--text-gray);">
                    Google Sheets APIã‚­ãƒ¼ã€OpenAI APIã‚­ãƒ¼ã€GAS URLï¼ˆä»»æ„ï¼‰ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚
                </p>
                <div class="section-actions">
                    <button class="btn btn-outline" onclick="toggleEmbed('apiSettingsEmbed','api-setup.html')">è¡¨ç¤º/éè¡¨ç¤º</button>
                    <a href="api-setup.html" class="btn btn-primary" target="_blank">æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</a>
                </div>
                <div id="apiSettingsEmbed" style="display: none; margin-top: 12px;">
                    <iframe id="apiSettingsIframe" src="" style="width: 100%; height: 900px; border: 1px solid var(--border-gray); border-radius: 8px;"></iframe>
                </div>
            </div>
        </section>
    </main>

    <script>
        // GASé€£æºï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ï¼‰
        let gasConnector;
        let formSubmitter;

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‹ã‚‰ active ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ãƒœã‚¿ãƒ³ã« active ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // é¸æŠã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById(`${tabName}-section`).classList.add('active');
            
            // ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ ã‚’æ›´æ–°
            updateBreadcrumb(tabName);
            // è¨­å®šå¾Œã«åæ˜ ã§ãã‚‹ã‚ˆã†ã€ãƒãƒƒãƒãƒ³ã‚°ã‚¿ãƒ–è¡¨ç¤ºæ™‚ã«å†åˆæœŸåŒ–
            if (tabName === 'matching') {
                initMatching();
            } else if (tabName === 'job-seeker-form') {
                loadJobSeekersDash();
            } else if (tabName === 'job-listings') {
                if (typeof loadJobListingsDash === 'function') loadJobListingsDash();
            } else if (tabName === 'dashboard') {
                updateStats();
            }
        }

        // åŸ‹ã‚è¾¼ã¿è¡¨ç¤ºåˆ‡æ›¿ï¼ˆåˆå›ã‚¯ãƒªãƒƒã‚¯æ™‚ã«srcè¨­å®šï¼‰
        function toggleEmbed(containerId, src) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const iframe = container.querySelector('iframe');
            const isHidden = container.style.display === 'none' || container.style.display === '';
            if (isHidden) {
                container.style.display = 'block';
                if (iframe && !iframe.src) {
                    iframe.src = src;
                }
            } else {
                container.style.display = 'none';
            }
        }

        // ãƒ–ãƒ¬ãƒƒãƒ‰ã‚¯ãƒ©ãƒ æ›´æ–°
        function updateBreadcrumb(tabName) {
            const breadcrumb = document.getElementById('breadcrumb');
            const tabNames = {
                'dashboard': 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰',
                'job-seeker-form': 'æ±‚è·è€…ç™»éŒ²',
                'job-listings': 'æ±‚äººç®¡ç†',
                'matching': 'ãƒãƒƒãƒãƒ³ã‚°',
                'analytics': 'åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ'
            };
            
            if (tabName === 'dashboard') {
                breadcrumb.innerHTML = `
                    <div class="breadcrumb-item">
                        <span>ğŸ </span>
                        <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                    </div>
                `;
            } else {
                breadcrumb.innerHTML = `
                    <div class="breadcrumb-item">
                        <span>ğŸ </span>
                        <span style="cursor: pointer;" onclick="switchTab('dashboard')">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                    </div>
                    <span class="breadcrumb-separator">></span>
                    <div class="breadcrumb-item">
                        <span>${tabNames[tabName]}</span>
                    </div>
                `;
            }
        }

        // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ï¼ˆGASã®ã¿ï¼‰
        async function updateStats() {
            try {
                let stats = null;
                if (typeof gasConnector !== 'undefined' && gasConnector) {
                    try { stats = await gasConnector.getStatistics(); } catch (e) { console.warn('GASçµ±è¨ˆå–å¾—å¤±æ•—', e); }
                }
                if (!stats) stats = { totalJobSeekers: 0, totalJobListings: 0, totalApplications: 0, successfulPlacements: 0 };

                document.getElementById('totalJobSeekers').textContent = stats.totalJobSeekers || '0';
                document.getElementById('totalJobs').textContent = stats.totalJobListings || '0';
                document.getElementById('activeMatches').textContent = stats.totalApplications || '0';
                document.getElementById('successfulPlacements').textContent = stats.successfulPlacements || '0';
                console.log('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ:', stats);
            } catch (error) {
                console.error('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('totalJobSeekers').textContent = '0';
                document.getElementById('totalJobs').textContent = '0';
                document.getElementById('activeMatches').textContent = '0';
                document.getElementById('successfulPlacements').textContent = '0';
            }
        }
        
        // 5åˆ†ãŠãã«çµ±è¨ˆã‚’è‡ªå‹•æ›´æ–°
        function startAutoUpdate() {
            // åˆå›å®Ÿè¡Œ
            updateStats();
            
            // 5åˆ†(300000ms)ãŠãã«æ›´æ–°
            setInterval(updateStats, 300000);
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // GASåˆæœŸåŒ–ï¼ˆå…ˆã«è¡Œã†ã“ã¨ã§åˆå›ã®çµ±è¨ˆã«ã‚‚åæ˜ ã•ã‚Œã‚‹ï¼‰
            const GAS_URL = (typeof GASUtils !== 'undefined') ? GASUtils.getGASUrl() : (typeof CONFIG !== 'undefined' ? CONFIG.GAS_URL : '');
            if (GAS_URL) {
                gasConnector = new GASConnector(GAS_URL);
                formSubmitter = new GASFormSubmitter(GAS_URL);
                console.log('GASé€£æºã‚’åˆæœŸåŒ–:', GAS_URL);
            } else {
                console.warn('GAS URL ãŒæœªè¨­å®šã§ã™ã€‚APIè¨­å®šã§ä¸Šæ›¸ãå¯èƒ½ã§ã™ã€‚');
            }
            // 5åˆ†ãŠãè‡ªå‹•æ›´æ–°ã‚’é–‹å§‹ï¼ˆåˆå›å®Ÿè¡Œã§GASå€¤ã‚’è¡¨ç¤ºï¼‰
            startAutoUpdate();
            
            // æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’å‹•çš„ã«ç”Ÿæˆï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
            setTimeout(() => {
                const activities = document.getElementById('recent-activities');
                activities.innerHTML = `
                    <div style="border-left: 3px solid var(--primary-blue); padding-left: 16px; margin-bottom: 16px;">
                        <div style="font-weight: 500; color: var(--text-dark);">æ–°ã—ã„æ±‚è·è€…ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸ</div>
                        <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">2æ™‚é–“å‰</div>
                    </div>
                    <div style="border-left: 3px solid var(--success); padding-left: 16px; margin-bottom: 16px;">
                        <div style="font-weight: 500; color: var(--text-dark);">æ±‚äººã€ŒWebãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã€ã®å¿œå‹ŸãŒã‚ã‚Šã¾ã—ãŸ</div>
                        <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">5æ™‚é–“å‰</div>
                    </div>
                    <div style="border-left: 3px solid var(--warning); padding-left: 16px;">
                        <div style="font-weight: 500; color: var(--text-dark);">AIã§3ä»¶ã®æ±‚äººã‚’è‡ªå‹•ç™»éŒ²ã—ã¾ã—ãŸ</div>
                        <div style="font-size: 12px; color: var(--text-gray); margin-top: 4px;">1æ—¥å‰</div>
                    </div>
                `;
            }, 1000);
            // ãƒãƒƒãƒãƒ³ã‚°åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            initMatching();
        });

        // ===== æ±‚è·è€…ä¸€è¦§ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰ =====
        let SEEKERS_CACHE_DASH = [];
        function pickDash(obj, keys) {
            for (const k of keys) {
                if (obj && obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== '') return obj[k];
            }
            return '';
        }
        function parseDateDash(val) {
            if (!val) return null;
            try {
                if (Object.prototype.toString.call(val) === '[object Date]') return val;
                const d = new Date(val);
                return isNaN(d.getTime()) ? null : d;
            } catch (_) { return null; }
        }
        async function loadJobSeekersDash() {
            const meta = document.getElementById('seekerMetaDash');
            const tbody = document.getElementById('seekerTableBodyDash');
            if (!meta || !tbody) return;
            try {
                meta.textContent = 'GASã‹ã‚‰èª­ã¿è¾¼ã¿ä¸­...';
                if (!window.gasConnector) {
                    const GAS_URL = (typeof GASUtils !== 'undefined') ? GASUtils.getGASUrl() : (typeof CONFIG !== 'undefined' ? CONFIG.GAS_URL : '');
                    if (GAS_URL) window.gasConnector = new GASConnector(GAS_URL);
                }
                let list = [];
                if (window.gasConnector) {
                    try { list = await window.gasConnector.getJobSeekers(); } catch (e) { console.warn('GASå–å¾—å¤±æ•—', e); }
                }
                if (!Array.isArray(list)) list = [];
                list.sort((a, b) => {
                    const da = parseDateDash(pickDash(a, ['ç™»éŒ²æ—¥æ™‚','ç™»éŒ²æ—¥','ä½œæˆæ—¥','created','timestamp']));
                    const db = parseDateDash(pickDash(b, ['ç™»éŒ²æ—¥æ™‚','ç™»éŒ²æ—¥','ä½œæˆæ—¥','created','timestamp']));
                    return (db?.getTime()||0) - (da?.getTime()||0);
                });
                SEEKERS_CACHE_DASH = list;
                renderSeekerTableDash();
            } catch (err) {
                console.error('æ±‚è·è€…ä¸€è¦§ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', err);
                meta.textContent = 'èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (err.message || err);
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color:#c00;">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>';
            }
        }
        function renderSeekerTableDash() {
            const meta = document.getElementById('seekerMetaDash');
            const tbody = document.getElementById('seekerTableBodyDash');
            if (!meta || !tbody) return;
            const q = (document.getElementById('seekerSearchDash').value || '').trim().toLowerCase();
            let rows = SEEKERS_CACHE_DASH;
            if (q) rows = rows.filter(o => JSON.stringify(o).toLowerCase().includes(q));
            meta.textContent = `è¡¨ç¤ºä»¶æ•°: ${rows.length} / ç·ä»¶æ•°: ${SEEKERS_CACHE_DASH.length}`;
            if (rows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color: var(--text-gray);">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }
            const html = rows.slice(0, 50).map(o => {
                const name = pickDash(o, ['æ°å','name']);
                const email = pickDash(o, ['ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹','email']);
                const loc = pickDash(o, ['å¸Œæœ›å‹¤å‹™åœ°','desiredLocation']);
                const sal = pickDash(o, ['å¸Œæœ›å¹´å','desiredSalary']);
                const status = pickDash(o, ['ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹','status']);
                const d = pickDash(o, ['ç™»éŒ²æ—¥æ™‚','ç™»éŒ²æ—¥','ä½œæˆæ—¥','created','timestamp']);
                return `
                    <tr>
                        <td>${name || '-'}</td>
                        <td>${email || '-'}</td>
                        <td>${loc || '-'}</td>
                        <td>${sal || '-'}</td>
                        <td>${status || '-'}</td>
                        <td>${d ? new Date(d).toLocaleString() : '-'}</td>
                    </tr>`;
            }).join('');
            tbody.innerHTML = html;
        }
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('seekerSearchDash');
            if (input) input.addEventListener('input', renderSeekerTableDash);
        });

        // ===== æ±‚äººä¸€è¦§ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼šæ±‚äººç®¡ç†å†…ï¼‰ =====
        let JOBS_CACHE_DASH = [];
        function salaryTextDash(job) {
            const s = (job['å¹´å'] || '').toString().trim();
            if (s) return s;
            const min = job['salaryMin'] || '';
            const max = job['salaryMax'] || '';
            return (min || max) ? `${min || ''}${(min||max?'-':'')}${max || ''}` : '';
        }
        async function loadJobListingsDash() {
            const meta = document.getElementById('jobMetaDash');
            const tbody = document.getElementById('jobTableBodyDash');
            if (!meta || !tbody) return;
            try {
                meta.textContent = 'GASã‹ã‚‰èª­ã¿è¾¼ã¿ä¸­...';
                if (!window.gasConnector) {
                    const GAS_URL = (typeof GASUtils !== 'undefined') ? GASUtils.getGASUrl() : (typeof CONFIG !== 'undefined' ? CONFIG.GAS_URL : '');
                    if (GAS_URL) window.gasConnector = new GASConnector(GAS_URL);
                }
                let list = [];
                if (window.gasConnector) {
                    try { list = await window.gasConnector.getJobListings(); } catch (e) { console.warn('GASå–å¾—å¤±æ•—', e); }
                }
                if (!Array.isArray(list)) list = [];
                list.sort((a,b) => {
                    const da = parseDateDash(pickDash(a, ['ç™»éŒ²æ—¥æ™‚','ç™»éŒ²æ—¥','ä½œæˆæ—¥','created','timestamp']));
                    const db = parseDateDash(pickDash(b, ['ç™»éŒ²æ—¥æ™‚','ç™»éŒ²æ—¥','ä½œæˆæ—¥','created','timestamp']));
                    return (db?.getTime()||0) - (da?.getTime()||0);
                });
                JOBS_CACHE_DASH = list;
                renderJobListingsDash();
            } catch (err) {
                console.error('æ±‚äººä¸€è¦§ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', err);
                meta.textContent = 'èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (err.message || err);
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color:#c00;">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</td></tr>';
            }
        }
        function renderJobListingsDash() {
            const meta = document.getElementById('jobMetaDash');
            const tbody = document.getElementById('jobTableBodyDash');
            if (!meta || !tbody) return;
            const q = (document.getElementById('jobSearchDash').value || '').trim().toLowerCase();
            let rows = JOBS_CACHE_DASH;
            if (q) rows = rows.filter(o => JSON.stringify(o).toLowerCase().includes(q));
            meta.textContent = `è¡¨ç¤ºä»¶æ•°: ${rows.length} / ç·ä»¶æ•°: ${JOBS_CACHE_DASH.length}`;
            if (rows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="padding:12px; color: var(--text-gray);">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }
            const html = rows.slice(0, 50).map(o => {
                const title = pickDash(o, ['æ±‚äººå','title']);
                const company = pickDash(o, ['ä¼šç¤¾å','company']);
                const loc = pickDash(o, ['å‹¤å‹™åœ°','location']);
                const sal = salaryTextDash(o);
                const status = pickDash(o, ['ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹','status']);
                const d = pickDash(o, ['ç™»éŒ²æ—¥æ™‚','ç™»éŒ²æ—¥','ä½œæˆæ—¥','created','timestamp']);
                return `
                    <tr>
                        <td>${title || '-'}</td>
                        <td>${company || '-'}</td>
                        <td>${loc || '-'}</td>
                        <td>${sal || '-'}</td>
                        <td>${status || '-'}</td>
                        <td>${d ? new Date(d).toLocaleString() : '-'}</td>
                    </tr>`;
            }).join('');
            tbody.innerHTML = html;
        }
        document.addEventListener('DOMContentLoaded', () => {
            const input2 = document.getElementById('jobSearchDash');
            if (input2) input2.addEventListener('input', renderJobListingsDash);
        });

        // ===== ã‚¹ãƒãƒ¼ãƒˆãƒãƒƒãƒãƒ³ã‚°ï¼ˆèª­ã¿è¾¼ã¿ã¯Google Sheets APIã‚’ä½¿ç”¨ï¼‰ =====

        let seekersData = [];
        let jobsData = [];

        let lastMatched = [];

        async function initMatching() {
            try {
                // ã¾ãšGASã‹ã‚‰ã®å–å¾—ã‚’è©¦ã™
                let seekers = [], jobs = [];
                let usedGAS = false;
                if (gasConnector) {
                    try {
                        GASUtils && GASUtils.showProgress && GASUtils.showProgress('GASã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
                        [seekers, jobs] = await Promise.all([
                            gasConnector.getJobSeekers(),
                            gasConnector.getJobListings()
                        ]);
                        // æœŸå¾…ã™ã‚‹é…åˆ—å½¢å¼ã‹æ¤œè¨¼
                        if (Array.isArray(seekers) && Array.isArray(jobs)) {
                            usedGAS = true;
                        } else {
                            console.warn('GASå¿œç­”ãŒé…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Sheets APIã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚');
                            usedGAS = false;
                        }
                    } catch (e) {
                        console.warn('GASã‹ã‚‰ã®å–å¾—ã«å¤±æ•—ã€Sheets APIã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', e);
                    }
                }

                if (!usedGAS) {
                    // æœ¬ç•ªé‹ç”¨ã§ã¯GASçµŒç”±ã®ã¿ã‚’ä½¿ç”¨ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç„¡åŠ¹ï¼‰
                    document.getElementById('matchingWarning').style.display = 'block';
                    const sel = document.getElementById('seekerSelect');
                    if (sel) sel.innerHTML = '<option value="">GASæœªæ¥ç¶š</option>';
                    GASUtils && GASUtils.hideProgress && GASUtils.hideProgress();
                    return;
                }

                seekersData = seekers;
                jobsData = jobs;

                populateSeekerSelect(seekersData);
                GASUtils && GASUtils.showProgress && GASUtils.showProgress('ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                setTimeout(() => GASUtils && GASUtils.hideProgress && GASUtils.hideProgress(), 800);
            } catch (error) {
                console.error('ãƒãƒƒãƒãƒ³ã‚°åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('matchingWarning').style.display = 'block';
                GASUtils && GASUtils.showProgress && GASUtils.showProgress('ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                setTimeout(() => GASUtils && GASUtils.hideProgress && GASUtils.hideProgress(), 2000);
            }
        }

        // GASå›ºå®šé‹ç”¨ã®ãŸã‚ã€localStorageè¨­å®šã®ç›£è¦–ã¯ä¸è¦

        function toObjects(headers, rows) {
            return rows.map(r => {
                const o = {}; headers.forEach((h, i) => o[h] = r[i]); return o;
            });
        }

        function populateSeekerSelect(list) {
            const sel = document.getElementById('seekerSelect');
            sel.innerHTML = '<option value="">æ±‚è·è€…ã‚’é¸æŠ</option>';
            list.forEach((s, idx) => {
                const name = s['æ°å'] || s['name'] || `æ±‚è·è€…${idx+1}`;
                const email = s['ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'] || s['email'] || '';
                const opt = document.createElement('option');
                opt.value = String(idx);
                opt.textContent = `${name}${email ? ' / ' + email : ''}`;
                sel.appendChild(opt);
            });
        }

        function runMatching() {
            const idx = document.getElementById('seekerSelect').value;
            const topN = parseInt(document.getElementById('topN').value, 10) || 10;
            const minScore = parseInt(document.getElementById('minScore').value, 10) || 0;
            const remoteOnly = document.getElementById('remoteOnly').checked;
            const locKw = (document.getElementById('locKeyword').value || '').trim();
            if (idx === '' || !seekersData.length || !jobsData.length) return;
            const seeker = seekersData[Number(idx)];
            let scored = jobsData
                .map(job => {
                    const score = computeScore(seeker, job);
                    const reasons = matchReasons(seeker, job);
                    const remoteHit = reasons.includes('ãƒªãƒ¢ãƒ¼ãƒˆ');
                    const jLoc = (job['å‹¤å‹™åœ°'] || job['location'] || '').toString();
                    const locHit = locKw ? jLoc.includes(locKw) : true;
                    return { job, score, reasons, remoteHit, locHit };
                })
                .filter(x => x.score >= minScore && x.locHit && (!remoteOnly || x.remoteHit))
                .sort((a,b) => b.score - a.score)
                .slice(0, topN);
            renderMatches(scored);
        }

        function parseSalary(s) {
            if (!s) return {min:null, max:null};
            const m = String(s).replace(/[,å††ä¸‡å††]/g,'');
            const parts = m.split('-').map(x => parseInt(x,10)).filter(n => !isNaN(n));
            if (parts.length === 1) return {min:parts[0], max:parts[0]};
            if (parts.length >= 2) return {min:parts[0], max:parts[1]};
            return {min:null, max:null};
        }

        function norm(str) { return String(str||'').toLowerCase().replace(/\s+/g,''); }
        function includesAny(text, keywords) {
            const t = norm(text);
            return keywords.some(k => t.includes(norm(k)));
        }

        // å˜ç´”åŠ ç‚¹ç‰ˆï¼ˆå„æ¡ä»¶1ç‚¹ï¼‰
        function computeScore(seeker, job) {
            const { matches } = evaluateMatches(seeker, job);
            // 1æ¡ä»¶=1ç‚¹ã§åˆè¨ˆ
            return Object.values(matches).reduce((acc, v) => acc + (v ? 1 : 0), 0);
        }

        function evaluateMatches(seeker, job) {
            const sLoc = (seeker['å¸Œæœ›å‹¤å‹™åœ°'] || seeker['desiredLocation'] || '').trim();
            const sLocDetail = (seeker['è©³ç´°å¸Œæœ›åœ°åŸŸ'] || seeker['specificCity'] || '').trim();
            const jLoc = (job['å‹¤å‹™åœ°'] || job['location'] || '').trim();

            const sSal = parseSalary(seeker['å¸Œæœ›å¹´å'] || seeker['desiredSalary']);
            const jSal = parseSalary(job['å¹´å'] || (job['salaryMin'] && job['salaryMax'] ? `${job['salaryMin']}-${job['salaryMax']}` : ''));

            const sWeekend = String(seeker['åœŸæ—¥ä¼‘ã¿å¸Œæœ›'] || '').includes('ã‚ã‚Š');
            const jWeekend = String(job['åœŸæ—¥ä¼‘ã¿'] || '').includes('ã‚ã‚Š');

            const sH = parseInt(String(seeker['å¹´é–“ä¼‘æ—¥å¸Œæœ›']||'').replace(/[^0-9]/g,''),10);
            const jH = parseInt(String(job['å¹´é–“ä¼‘æ—¥']||'').replace(/[^0-9]/g,''),10);

            const sReqList = (seeker['å¿œå‹Ÿæ¡ä»¶'] || seeker['requirements'] || '').split(/[ã€,\s]+/).filter(Boolean);
            const jReqText = (job['å¿œå‹Ÿæ¡ä»¶'] || job['requirements'] || '').toString();

            // è¿½åŠ ã®ã‚ˆãã‚ã‚‹æ¡ä»¶
            const sEmp = (seeker['é›‡ç”¨å½¢æ…‹'] || seeker['employmentType'] || '').trim();
            const jEmp = (job['é›‡ç”¨å½¢æ…‹'] || job['employmentType'] || '').trim();
            const seekerWantsRemote = includesAny(sLoc + ' ' + sLocDetail + ' ' + sReqList.join(' '), ['ãƒªãƒ¢ãƒ¼ãƒˆ','åœ¨å®…','ãƒ•ãƒ«ãƒªãƒ¢ãƒ¼ãƒˆ']);
            const jobIsRemote = includesAny(jLoc + ' ' + (job['å‚™è€ƒ']||job['notes']||''), ['ãƒªãƒ¢ãƒ¼ãƒˆ','åœ¨å®…','ãƒ•ãƒ«ãƒªãƒ¢ãƒ¼ãƒˆ']);
            const sRole = (seeker['å¸Œæœ›è·ç¨®'] || seeker['jobTypes'] || '').toString();
            const jRoleText = (job['è·ç¨®'] || job['æ±‚äººå'] || job['title'] || '').toString();

            const matches = {
                location: !!(sLoc && jLoc && jLoc.includes(sLoc)) || (!!sLocDetail && jLoc.includes(sLocDetail)),
                salary: !!(sSal.min && jSal.max && jSal.max >= sSal.min),
                weekendOff: sWeekend && jWeekend,
                annualHolidays: (!isNaN(sH) && !isNaN(jH) && jH >= sH),
                requirements: sReqList.length > 0 && sReqList.some(k => jReqText.includes(k)),
                employmentType: !!(sEmp && jEmp && (jEmp.includes(sEmp) || sEmp.includes(jEmp))),
                remote: seekerWantsRemote ? jobIsRemote : false,
                role: !!(sRole && jRoleText && includesAny(jRoleText, Array.isArray(sRole)? sRole : String(sRole).split(/[ã€,\s]+/)))
            };

            return { matches };
        }

        function matchReasons(seeker, job) {
            const { matches } = evaluateMatches(seeker, job);
            const reasons = [];
            if (matches.location) reasons.push('å‹¤å‹™åœ°');
            if (matches.salary) reasons.push('å¹´å');
            if (matches.weekendOff) reasons.push('åœŸæ—¥ä¼‘ã¿');
            if (matches.annualHolidays) reasons.push('å¹´é–“ä¼‘æ—¥');
            if (matches.requirements) reasons.push('å¿œå‹Ÿæ¡ä»¶');
            if (matches.employmentType) reasons.push('é›‡ç”¨å½¢æ…‹');
            if (matches.remote) reasons.push('ãƒªãƒ¢ãƒ¼ãƒˆ');
            if (matches.role) reasons.push('è·ç¨®');
            return reasons;
        }

        function renderMatches(items) {
            const tbody = document.getElementById('matchingBody');
            tbody.innerHTML = '';
            if (!items.length) {
                tbody.innerHTML = '<tr><td colspan="6" style="color: var(--text-gray);">ä¸€è‡´ã™ã‚‹æ±‚äººãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</td></tr>';
                return;
            }
            const total = 8; // æ¡ä»¶æ•°
            lastMatched = items;
            items.forEach(({job, score, reasons}, idx) => {
                const tr = document.createElement('tr');
                const salary = job['å¹´å'] || (job['salaryMin'] && job['salaryMax'] ? `${job['salaryMin']}-${job['salaryMax']}` : '');
                const chips = reasons.map(r => `<span style="display:inline-block; padding:2px 6px; margin:2px; border:1px solid #e2e8f0; border-radius:12px; font-size:11px; background:#f8fafc;">${r}</span>`).join('');
                tr.innerHTML = `
                    <td><input type="checkbox" class="match-select" data-index="${idx}" /></td>
                    <td><strong>${score}</strong> / ${total}</td>
                    <td>${job['æ±‚äººå'] || job['title'] || ''}</td>
                    <td>${job['ä¼šç¤¾å'] || job['company'] || ''}</td>
                    <td>${salary}</td>
                    <td>${job['å‹¤å‹™åœ°'] || job['location'] || ''}</td>
                    <td>${chips}</td>
                `;
                // è©³ç´°è¡Œï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹ï¼‰
                const details = document.createElement('tr');
                details.style.display = 'none';
                const detailsTd = document.createElement('td');
                detailsTd.colSpan = 6;
                detailsTd.style.background = '#f8fafc';
                detailsTd.style.borderLeft = '3px solid #2563eb';
                const jobReq = job['å¿œå‹Ÿæ¡ä»¶'] || job['requirements'] || '';
                const jobNotes = job['å‚™è€ƒ'] || job['notes'] || '';
                detailsTd.innerHTML = `
                    <div style="padding:12px;">
                        <div style="font-size:13px; color:#64748b; margin-bottom:6px;">è©³ç´°</div>
                        ${jobReq ? `<div><strong>å¿œå‹Ÿæ¡ä»¶:</strong> ${jobReq}</div>` : ''}
                        ${jobNotes ? `<div style="margin-top:6px;"><strong>å‚™è€ƒ:</strong> ${jobNotes}</div>` : ''}
                    </div>
                `;
                details.appendChild(detailsTd);

                tr.style.cursor = 'pointer';
                tr.addEventListener('click', () => {
                    details.style.display = details.style.display === 'none' ? '' : 'none';
                });

                tbody.appendChild(tr);
                tbody.appendChild(details);
            });
        }

        async function saveSelectedApplications() {
            try {
                const idx = document.getElementById('seekerSelect').value;
                if (idx === '' || !seekersData.length) {
                    alert('æ±‚è·è€…ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                const seeker = seekersData[Number(idx)];
                const seekerName = seeker['æ°å'] || seeker['name'] || '';
                const checks = Array.from(document.querySelectorAll('.match-select:checked'));
                if (checks.length === 0) {
                    alert('ç™»éŒ²ã™ã‚‹æ±‚äººã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                if (!gasConnector || !formSubmitter) {
                    alert('GASé€£æºãŒæœªè¨­å®šã§ã™ã€‚APIè¨­å®šã§GAS URLã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                GASUtils && GASUtils.showProgress && GASUtils.showProgress('å¿œå‹Ÿç®¡ç†ã«ç™»éŒ²ä¸­...');
                let ok = 0, ng = 0;
                for (const c of checks) {
                    const i = Number(c.getAttribute('data-index'));
                    const item = lastMatched[i];
                    if (!item) { ng++; continue; }
                    const job = item.job;
                    const payload = {
                        jobSeekerName: seekerName,
                        jobTitle: job['æ±‚äººå'] || job['title'] || '',
                        company: job['ä¼šç¤¾å'] || job['company'] || '',
                        status: 'å€™è£œ'
                    };
                    try {
                        try {
                            await gasConnector.upsertApplication(payload);
                        } catch (e) {
                            await formSubmitter.submitData('upsertApplication', payload);
                        }
                        ok++;
                    } catch (e) {
                        console.warn('ç™»éŒ²å¤±æ•—:', e);
                        ng++;
                    }
                }
                alert(`å¿œå‹Ÿç®¡ç†ã«ç™»éŒ²ã—ã¾ã—ãŸ: æˆåŠŸ ${ok}ä»¶ / å¤±æ•— ${ng}ä»¶`);
                GASUtils && GASUtils.showProgress && GASUtils.showProgress('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ');
            } catch (e) {
                console.error('å¿œå‹Ÿç®¡ç†ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', e);
                alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (e.message || e));
            }
        }
    </script>
</body>
</html>
